# 【开源】TGMA：放弃向量数据库：我用极简 SQLite 时间轴，手搓了一个「永不失忆」且带时间感的 AI 记忆引擎

TGMA = Temporal-Grounded Memory Architecture

**时间锚定记忆架构 | 轻量 | 时序正确 | 降低幻觉 | 可扩展的长期记忆**

---

## 🚀 为什么做这个项目？

目前主流 AI Agent 记忆几乎全是向量数据库，但在 **虚拟伴侣、桌面宠物、个人私教、长期陪伴 AI** 场景里，纯向量检索是灾难：

* **时序错乱**：向量只管语义，不管时间，AI 把半年前的事当成昨天。
* **幻觉拼贴**：碎片乱拼，A 事件细节缝到 B 事件上。
* **统计无能**：无法回答「这周我抱怨了几次」「昨天聊了什么」。
* **成本高**：向量库部署、维护、检索都更重。

于是我放弃向量库，只用 **SQLite + 时间轴**，手搓了这套真正像人类一样记忆的引擎。

---

## 🧠 核心三大模块

### 模块一：动态时间标签注入（人类级时间感）

* **不浪费 Token 写死日期**：通过逻辑动态判断。
* **视觉呼吸感**：今天只显示 `[HH:MM]`，往日显示 `[MM-DD HH:MM]`。
* **拟人共情**：AI 能感知节奏、间隔、时差，会记得你多久没理她。

### 模块二：无情史官·降维压缩（防上下文爆炸）

* **自动触发**：达到 30 条记录自动触发后台小模型总结。
* **软着陆衔接**：强制保留最后 2 条记录不压缩，确保对话连续性。
* **时间锚点**：保留“日期+时段”信息，把废话变记忆。

### 模块三：主动打捞·侦探模型（Agentic RAG）

* **主动打捞**：主模型不懂时主动抛出 `[RECALL|日期|问题]`。
* **开卷考试**：侦探模型只读当天原始日志，精准还原真相。
* **零幻觉**：查不到就说不知道，绝不编造。

---

## 🎨 架构逻辑示意图

```mermaid
graph TD
    A["用户输入: 昨晚我熬夜了吗?"] --> B{"主脑 Akane 思考"}
    B -->|近期记忆不足| C["触发 [RECALL] 拦截"]
    C --> D["侦探下潜: 锁定指定日期 + 时间轴"]
    D --> E["精准证据: 23:45 记录到 Master 在敲代码"]
    E --> F["带语境的事实反馈"]
    F --> G["最终回复: 哼, 昨晚 11 点多你还在卷, 快去补觉!"]
    
    subgraph 异步代谢
    H["原始日志堆积"] --> I["史官 AI 压缩"]
    I --> J["存入中长期摘要表"]
    end

```

---

## 🚀 未来可扩展性 (Scalability)

TGMA 架构不仅是一个引擎，更是一个可以无限生长的基座：

1. **多模态记忆扩展 (Multimodal Memory)**
* **设计**：在 `chat_logs` 中增加 `image_hash` 或 `video_timestamp` 字段。
* **效果**：你可以问：“上周三我给你看的那张照片里有什么？”侦探模型会直接定位到那一刻的图片描述。


2. **情感与代谢模拟 (Emotional Decay)**
* **设计**：在史官压缩时，增加一个 `emotion_score` 字段。
* **效果**：AI 会根据时间流逝，对很久远、情感淡漠的记忆进行更大幅度的降维，模拟人类“选择性遗忘”的特征。


3. **外部知识挂载 (Dynamic RAG Integration)**
* **设计**：扩展 `[RECALL]` 标签，使其不仅能查本地数据库，还能查搜索引擎或本地文件。
* **效果**：实现本地私有知识与长期历史记忆的完美融合。


4. **分布式“脑群” (Distributed Brain)**
* **设计**：主脑在云端（强大推理），侦探模型在本地（隐私保护）。
* **效果**：极大地降低 Token 成本，同时保护用户隐私日志不出本地。



---

## ⚡ 亮点

* ✅ **只用 SQLite**：无需安装沉重的向量数据库。
* ✅ **时序绝对正确**：基于时间轴打捞，记忆不穿越、不乱序。
* ✅ **零幻觉**：查不到就说不知道，每一条回忆都有据可查。
* ✅ **软着陆衔接**：总结后自动保留最后 2 条原始记录，确保聊天不“断片”。

---

## 作者

由喜欢做桌面宠物的开发者开源，欢迎 Star & Fork & 魔改！

---



